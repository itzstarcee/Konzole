<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foro Comunitario Simple</title>
    <style>
        /* CSS Básico (Puedes moverlo a un archivo style.css) */
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; }
        header { text-align: center; padding: 10px; background-color: #333; color: white; }
        .forum-container { display: flex; max-width: 1200px; margin: 20px auto; }
        #forum-list { width: 25%; padding: 15px; background-color: #eee; border-radius: 5px; }
        #main-content { width: 75%; padding: 15px; background-color: white; border-radius: 5px; margin-left: 20px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .forum-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .message { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; border-radius: 5px; position: relative; }
        .message strong { color: #0056b3; }
        .delete-btn { position: absolute; top: 10px; right: 10px; background: none; border: none; color: red; cursor: pointer; font-size: 14px; }
        textarea, input[type="text"] { width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { padding: 10px 15px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        .private-forum { background-color: #ffe0e0; border-left: 5px solid red; }
        .forum-item { cursor: pointer; padding: 8px; margin-bottom: 5px; border-bottom: 1px dotted #ccc; }
    </style>
</head>
<body>

    <header>
        <h1>Foro Comunitario</h1>
    </header>

    <div class="forum-container">
        
        <div id="forum-list">
            <h2>Foros</h2>
            <button onclick="showCreateForum()">Crear Nuevo Foro</button>
            <div id="forums">
                </div>
        </div>

        <div id="main-content">
            <div class="forum-header">
                <h2 id="current-forum-title">Selecciona un Foro</h2>
                <span id="forum-type"></span>
            </div>
            
            <div id="message-form" style="border-top: 1px solid #ccc; padding-top: 15px; margin-top: 15px;">
                <h3>Enviar Mensaje</h3>
                <input type="text" id="username" placeholder="Tu Nombre" required>
                <textarea id="message-text" placeholder="Escribe tu mensaje..." rows="4" required></textarea>
                <button onclick="sendMessage()">Publicar Mensaje</button>
            </div>

            <h3>Mensajes</h3>
            <div id="messages-container">
                </div>
        </div>
    </div>

    <div id="create-forum-modal" style="display:none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border: 1px solid #333; z-index: 10;">
        <h3>Crear Nuevo Foro</h3>
        <input type="text" id="new-forum-title" placeholder="Título del Foro" required>
        <label>
            <input type="checkbox" id="is-private"> Foro Privado (Requiere Contraseña)
        </label>
        <input type="password" id="private-password" placeholder="Contraseña (solo si es privado)" style="display:none;">
        <button onclick="createForum()">Crear</button>
        <button onclick="document.getElementById('create-forum-modal').style.display='none'">Cancelar</button>
    </div>

    <script>
        // Funcionalidad de JavaScript (simulación sin servidor)
        
        let currentForumId = null;
        
        // Carga los foros desde localStorage o usa un valor por defecto
        let forums = JSON.parse(localStorage.getItem('forums')) || [
            { id: 1, title: "Anuncios Públicos", isPrivate: false, messages: [] },
            { id: 2, title: "Discusión General", isPrivate: false, messages: [] },
            { id: 3, title: "Foro Privado Admin", isPrivate: true, password: "admin", messages: [] }
        ];

        function saveForums() {
            localStorage.setItem('forums', JSON.stringify(forums));
        }

        function renderForums() {
            const list = document.getElementById('forums');
            list.innerHTML = '';
            forums.forEach(forum => {
                const div = document.createElement('div');
                div.className = 'forum-item' + (forum.isPrivate ? ' private-forum' : '');
                div.textContent = forum.title + (forum.isPrivate ? ' 🔒' : ' 🌎');
                div.onclick = () => selectForum(forum.id);
                list.appendChild(div);
            });
        }
        
        function selectForum(id) {
            const forum = forums.find(f => f.id === id);
            
            if (forum.isPrivate) {
                const password = prompt("Introduce la contraseña para acceder a " + forum.title + ":");
                if (password !== forum.password) {
                    alert("Contraseña incorrecta.");
                    return;
                }
            }
            
            currentForumId = id;
            document.getElementById('current-forum-title').textContent = forum.title;
            document.getElementById('forum-type').textContent = forum.isPrivate ? '(Privado)' : '(Público)';
            renderMessages();
        }

        function renderMessages() {
            if (!currentForumId) return;

            const forum = forums.find(f => f.id === currentForumId);
            const container = document.getElementById('messages-container');
            container.innerHTML = '';

            forum.messages.forEach(msg => {
                const div = document.createElement('div');
                div.className = 'message';
                div.innerHTML = `
                    <strong>${msg.username}</strong> <small>(${msg.timestamp})</small>:
                    <p>${msg.text}</p>
                    <button class="delete-btn" onclick="deleteMessage(${forum.id}, '${msg.id}')">Eliminar</button>
                `;
                container.appendChild(div);
            });
        }

        function sendMessage() {
            if (!currentForumId) {
                alert("Por favor, selecciona un foro primero.");
                return;
            }
            
            const username = document.getElementById('username').value.trim();
            const text = document.getElementById('message-text').value.trim();

            if (!username || !text) {
                alert("Ambos campos son obligatorios.");
                return;
            }
            
            const forum = forums.find(f => f.id === currentForumId);
            const newMessage = {
                id: Date.now().toString(), // ID único simple
                username: username,
                text: text,
                timestamp: new Date().toLocaleTimeString()
            };

            forum.messages.push(newMessage);
            saveForums();
            document.getElementById('message-text').value = ''; // Limpiar textarea
            renderMessages();
        }
        
        function deleteMessage(forumId, messageId) {
            if (!confirm("¿Estás seguro de que quieres eliminar este mensaje?")) return;
            
            const forum = forums.find(f => f.id === forumId);
            forum.messages = forum.messages.filter(msg => msg.id !== messageId);
            saveForums();
            renderMessages();
        }

        function showCreateForum() {
            document.getElementById('create-forum-modal').style.display = 'block';
            document.getElementById('is-private').onchange = (e) => {
                document.getElementById('private-password').style.display = e.target.checked ? 'block' : 'none';
                document.getElementById('private-password').required = e.target.checked;
            };
        }

        function createForum() {
            const title = document.getElementById('new-forum-title').value.trim();
            const isPrivate = document.getElementById('is-private').checked;
            const password = document.getElementById('private-password').value.trim();

            if (!title) {
                alert("El título del foro es obligatorio.");
                return;
            }

            if (isPrivate && !password) {
                alert("Un foro privado requiere una contraseña.");
                return;
            }

            const newForum = {
                id: Date.now(),
                title: title,
                isPrivate: isPrivate,
                password: isPrivate ? password : null,
                messages: []
            };

            forums.push(newForum);
            saveForums();
            renderForums();
            document.getElementById('create-forum-modal').style.display = 'none';
            document.getElementById('new-forum-title').value = '';
            document.getElementById('is-private').checked = false;
            document.getElementById('private-password').value = '';
        }

        // Inicializar
        renderForums();
        
    </script>

</body>
</html>
